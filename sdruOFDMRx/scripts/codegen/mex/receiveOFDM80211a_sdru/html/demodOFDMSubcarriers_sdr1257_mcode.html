<pre class="code">
<span class="srcline"><span class="lineno"><a href="157,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">BER</span>, <span class="var type1" id="S3T23U4">estimate</span>] = demodOFDMSubcarriers_sdr( <span class="var type1" id="S4T25U7">R</span>, <span class="mxinfo" id="T1:U4"><span class="var type1" id="S5T1U8">tx</span></span>, <span class="mxinfo" id="T23:U6"><span class="mxinfo" id="T23:U7"><span class="var type1" id="S3T23U9">estimate</span></span></span> )</span></span>
<span class="srcline"><span class="lineno"><a href="157,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% demodOFDMSubcarriers: Hard demodulate then compare received and</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% transmitted data</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,5" id="srcline5"> 5</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="157,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% Demodulate subcarrier data</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo" id="T730:U9"><span class="var type1" id="S6T730U12">RLinear</span> = <span class="mxinfo" id="T730:U11">reshape(<span class="var type1" id="S4T25U15">R</span>,size(<span class="var type1" id="S4T25U19">R</span>,1)*size(<span class="var type1" id="S4T25U23">R</span>,2),1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="157,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T731:U15"><span class="var type1" id="S9T731U28">RHard</span> = <span class="mxinfo" id="T731:U17"><span class="mxinfo" id="T816:U18"><span class="var type1" id="S6T730U31">RLinear</span>(<span class="mxinfo" id="T817:U20"><span class="mxinfo" id="T2:U21">1</span>:<span class="mxinfo" id="T2:U22">end-<span class="var type1" id="S5T1U38">tx</span>.padBits</span></span>)</span> &lt; <span class="mxinfo" id="T2:U24">0</span></span></span>; <span class="comment">%Bits</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="157,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Decode received text</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,11" id="srcline11">11</a></span><span class="line"><span class="comment">%estimate.message = OFDMbits2letters(RHard &gt; 0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,12" id="srcline12">12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="157,13" id="srcline13">13</a></span><span class="line"><span class="comment">% Check results</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo" id="T2:U25"><span class="var type1" id="S2T2U43">BER</span> = <span class="mxinfo" id="T2:U27"><span class="mxinfo" id="T2:U28">sum(<span class="mxinfo" id="T731:U29"><span class="var type1" id="S9T731U48">RHard</span>~=<span class="mxinfo" id="T8:U31"><span class="var type1" id="S5T1U50">tx</span>.originalData</span></span>)</span>/<span class="mxinfo" id="T2:U33">numel(<span class="var type1" id="S9T731U54">RHard</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="157,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="157,16" id="srcline16">16</a></span><span class="line"><span class="comment">% Save additional information</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,17" id="srcline17">17</a></span><span class="line"><span class="comment">%estimate.totalFrameErrors(estimate.numProcessed) = sum(RHard~=tx.originalData);</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,18" id="srcline18">18</a></span><span class="line"><span class="comment">%estimate.totalFrameBits(estimate.numProcessed) = numel(RHard);           </span></span></span>
<span class="srcline"><span class="lineno"><a href="157,19" id="srcline19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="157,20" id="srcline20">20</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="157,21" id="srcline21">21</a></span><span class="line"></span></span>
</pre>
